<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CIS Assessment Tracker with Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e1e8ed;
            padding-bottom: 0;
        }

        .tab {
            padding: 12px 24px;
            background: white;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #5a6c7d;
            border-radius: 8px 8px 0 0;
            transition: all 0.3s;
            border: 2px solid transparent;
            border-bottom: none;
        }

        .tab:hover {
            background: #f8f9fa;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-color: #e1e8ed;
            border-bottom-color: white;
            position: relative;
            bottom: -2px;
        }

        .tab-content {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 0 10px 10px 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .tab-content.active {
            display: block;
        }

        /* Dashboard Styles */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: white;
            padding: 24px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-left: 4px solid #667eea;
        }

        .metric-card h3 {
            font-size: 14px;
            color: #5a6c7d;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .metric-value {
            font-size: 36px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .metric-label {
            font-size: 13px;
            color: #718096;
        }

        .chart-container {
            background: white;
            padding: 24px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }

        .chart-container h3 {
            font-size: 16px;
            color: #2d3748;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .progress-bar {
            width: 100%;
            height: 40px;
            background: #e2e8f0;
            border-radius: 20px;
            overflow: hidden;
            position: relative;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

        .bar-chart {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .bar-item {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .bar-label {
            min-width: 180px;
            font-size: 13px;
            color: #4a5568;
            font-weight: 500;
        }

        .bar-bg {
            flex: 1;
            height: 30px;
            background: #f7fafc;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .bar-fill {
            height: 100%;
            border-radius: 15px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            padding-left: 12px;
            color: white;
            font-size: 12px;
            font-weight: 600;
        }

        /* Assessment Table */
        .controls-table {
            width: 100%;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        thead {
            background: #f7fafc;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        th {
            padding: 14px 12px;
            text-align: left;
            font-weight: 600;
            color: #2d3748;
            border-bottom: 2px solid #e2e8f0;
            white-space: nowrap;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
            vertical-align: top;
        }

        tr:hover {
            background: #fafbfc;
        }

        select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 13px;
            background: white;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        select:focus {
            outline: none;
            border-color: #667eea;
        }

        input[type="text"], textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 13px;
            font-family: inherit;
        }

        textarea {
            min-height: 60px;
            resize: vertical;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-implemented {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-partial {
            background: #fef5e7;
            color: #975a16;
        }

        .status-not-implemented {
            background: #fed7d7;
            color: #742a2a;
        }

        .status-na {
            background: #e2e8f0;
            color: #4a5568;
        }

        .risk-critical {
            background: #dc2626;
        }

        .risk-high {
            background: #f97316;
        }

        .risk-medium {
            background: #eab308;
        }

        .risk-low {
            background: #22c55e;
        }

        .btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background 0.2s;
        }

        .btn:hover {
            background: #5568d3;
        }

        .btn-secondary {
            background: #718096;
        }

        .btn-secondary:hover {
            background: #4a5568;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .legend {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin: 20px 0;
            padding: 16px;
            background: #f7fafc;
            border-radius: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        .top-gaps {
            margin-top: 20px;
        }

        .gap-item {
            padding: 16px;
            border-left: 4px solid #dc2626;
            background: #fef2f2;
            margin-bottom: 12px;
            border-radius: 6px;
        }

        .gap-item h4 {
            font-size: 14px;
            margin-bottom: 6px;
            color: #991b1b;
        }

        .gap-item p {
            font-size: 12px;
            color: #6b7280;
        }

        @media print {
            .tabs, .action-buttons {
                display: none;
            }
            .tab-content {
                display: block !important;
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõ°Ô∏è CIS Controls v8 Assessment Tracker</h1>
            <p>Comprehensive assessment and compliance dashboard for CIS Controls implementation</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('dashboard')">Dashboard</button>
            <button class="tab" onclick="switchTab('assessment')">Assessment</button>
            <button class="tab" onclick="switchTab('export')">Export</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="dashboard-grid">
                <div class="metric-card">
                    <h3>Overall Compliance</h3>
                    <div class="metric-value" id="overallScore">0%</div>
                    <div class="metric-label">Weighted Score</div>
                </div>
                <div class="metric-card" style="border-left-color: #22c55e;">
                    <h3>Fully Implemented</h3>
                    <div class="metric-value" id="fullyImplemented">0</div>
                    <div class="metric-label">Safeguards</div>
                </div>
                <div class="metric-card" style="border-left-color: #eab308;">
                    <h3>Partially Implemented</h3>
                    <div class="metric-value" id="partiallyImplemented">0</div>
                    <div class="metric-label">Safeguards</div>
                </div>
                <div class="metric-card" style="border-left-color: #dc2626;">
                    <h3>Not Implemented</h3>
                    <div class="metric-value" id="notImplemented">0</div>
                    <div class="metric-label">Safeguards</div>
                </div>
            </div>

            <div class="chart-container">
                <h3>Overall Progress</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar" style="width: 0%">0%</div>
                </div>
            </div>

            <div class="chart-container">
                <h3>Compliance by CIS Control</h3>
                <div class="bar-chart" id="controlChart"></div>
            </div>

            <div class="chart-container">
                <h3>Risk Distribution</h3>
                <div class="bar-chart" id="riskChart"></div>
            </div>

            <div class="chart-container">
                <h3>Top 10 Critical Gaps</h3>
                <div class="top-gaps" id="topGaps"></div>
            </div>
        </div>

        <!-- Assessment Tab -->
        <div id="assessment" class="tab-content">
            <div class="action-buttons">
                <button class="btn" onclick="saveData()">üíæ Save Progress</button>
                <button class="btn btn-secondary" onclick="loadSampleData()">üìã Load Sample Data</button>
                <button class="btn btn-secondary" onclick="clearData()">üóëÔ∏è Clear All</button>
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #22c55e;"></div>
                    <span>Fully Implemented (100%)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #eab308;"></div>
                    <span>Partially Implemented (50%)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #dc2626;"></div>
                    <span>Not Implemented (0%)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #9ca3af;"></div>
                    <span>Not Applicable (N/A)</span>
                </div>
            </div>

            <div class="controls-table">
                <table id="assessmentTable">
                    <thead>
                        <tr>
                            <th>Control</th>
                            <th>Safeguard</th>
                            <th>Title</th>
                            <th>Category</th>
                            <th>Implementation Status</th>
                            <th>Evidence/Notes</th>
                            <th>Risk Level</th>
                            <th>Priority</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Export Tab -->
        <div id="export" class="tab-content">
            <h2 style="margin-bottom: 20px;">Export Assessment Data</h2>
            <div class="action-buttons">
                <button class="btn" onclick="exportToCSV()">üìä Export to CSV</button>
                <button class="btn btn-secondary" onclick="exportToJSON()">üìÑ Export to JSON</button>
                <button class="btn btn-secondary" onclick="window.print()">üñ®Ô∏è Print Report</button>
            </div>
            <div class="chart-container">
                <h3>Export Instructions</h3>
                <p style="margin-bottom: 12px;">You can export your assessment data in the following formats:</p>
                <ul style="margin-left: 20px; line-height: 1.8;">
                    <li><strong>CSV:</strong> Opens in Excel/Google Sheets for further analysis</li>
                    <li><strong>JSON:</strong> For backup or importing into other systems</li>
                    <li><strong>Print:</strong> Generate a PDF report of the dashboard</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const cisControls = [
            {id: 1, safeguard: '1.1', title: 'Establish and Maintain Detailed Enterprise Asset Inventory', category: 'Inventory and Control of Enterprise Assets'},
            {id: 1, safeguard: '1.2', title: 'Address Unauthorized Assets', category: 'Inventory and Control of Enterprise Assets'},
            {id: 2, safeguard: '2.1', title: 'Establish and Maintain a Software Inventory', category: 'Inventory and Control of Software Assets'},
            {id: 2, safeguard: '2.2', title: 'Ensure Authorized Software is Currently Supported', category: 'Inventory and Control of Software Assets'},
            {id: 3, safeguard: '3.1', title: 'Establish and Maintain a Data Management Process', category: 'Data Protection'},
            {id: 3, safeguard: '3.3', title: 'Configure Data Access Control Lists', category: 'Data Protection'},
            {id: 3, safeguard: '3.6', title: 'Encrypt Data on End-User Devices', category: 'Data Protection'},
            {id: 4, safeguard: '4.1', title: 'Establish and Maintain a Secure Configuration Process', category: 'Secure Configuration'},
            {id: 4, safeguard: '4.3', title: 'Configure Automatic Session Locking', category: 'Secure Configuration'},
            {id: 5, safeguard: '5.1', title: 'Establish and Maintain an Inventory of Accounts', category: 'Account Management'},
            {id: 5, safeguard: '5.2', title: 'Use Unique Passwords', category: 'Account Management'},
            {id: 5, safeguard: '5.3', title: 'Disable Dormant Accounts', category: 'Account Management'},
            {id: 6, safeguard: '6.1', title: 'Establish an Access Granting Process', category: 'Access Control'},
            {id: 6, safeguard: '6.3', title: 'Require MFA for Externally-Exposed Applications', category: 'Access Control'},
            {id: 6, safeguard: '6.5', title: 'Require MFA for Administrative Access', category: 'Access Control'},
            {id: 7, safeguard: '7.1', title: 'Establish and Maintain a Vulnerability Management Process', category: 'Vulnerability Management'},
            {id: 7, safeguard: '7.3', title: 'Perform Automated Operating System Patch Management', category: 'Vulnerability Management'},
            {id: 8, safeguard: '8.1', title: 'Establish and Maintain an Audit Log Management Process', category: 'Audit Log Management'},
            {id: 8, safeguard: '8.2', title: 'Collect Audit Logs', category: 'Audit Log Management'},
            {id: 10, safeguard: '10.1', title: 'Deploy and Maintain Anti-Malware Software', category: 'Malware Defenses'},
            {id: 11, safeguard: '11.2', title: 'Perform Automated Backups', category: 'Data Recovery'},
            {id: 14, safeguard: '14.1', title: 'Establish and Maintain a Security Awareness Program', category: 'Security Awareness'},
            {id: 17, safeguard: '17.1', title: 'Designate Personnel to Manage Incident Handling', category: 'Incident Response'}
        ];

        let assessmentData = {};

        function initializeTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            
            cisControls.forEach((control, index) => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${control.id}</td>
                    <td><strong>${control.safeguard}</strong></td>
                    <td>${control.title}</td>
                    <td style="font-size: 11px; color: #718096;">${control.category}</td>
                    <td>
                        <select onchange="updateStatus(${index}, this.value)">
                            <option value="">-- Select --</option>
                            <option value="implemented">‚úÖ Fully Implemented</option>
                            <option value="partial">‚ö†Ô∏è Partially Implemented</option>
                            <option value="not-implemented">‚ùå Not Implemented</option>
                            <option value="na">‚äó Not Applicable</option>
                        </select>
                    </td>
                    <td>
                        <textarea placeholder="Enter evidence and notes..." onchange="updateNotes(${index}, this.value)"></textarea>
                    </td>
                    <td>
                        <select onchange="updateRisk(${index}, this.value)">
                            <option value="">-- Select --</option>
                            <option value="critical">üî¥ Critical</option>
                            <option value="high">üü† High</option>
                            <option value="medium">üü° Medium</option>
                            <option value="low">üü¢ Low</option>
                            <option value="na">N/A</option>
                        </select>
                    </td>
                    <td>
                        <select onchange="updatePriority(${index}, this.value)">
                            <option value="">-- Select --</option>
                            <option value="immediate">Immediate (0-7 days)</option>
                            <option value="short">Short-term (1-30 days)</option>
                            <option value="medium">Medium-term (1-3 months)</option>
                            <option value="long">Long-term (3-12 months)</option>
                        </select>
                    </td>
                `;
                
                assessmentData[index] = {
                    control: control,
                    status: '',
                    notes: '',
                    risk: '',
                    priority: ''
                };
            });
        }

        function updateStatus(index, status) {
            assessmentData[index].status = status;
            updateDashboard();
            saveData();
        }

        function updateNotes(index, notes) {
            assessmentData[index].notes = notes;
            saveData();
        }

        function updateRisk(index, risk) {
            assessmentData[index].risk = risk;
            updateDashboard();
            saveData();
        }

        function updatePriority(index, priority) {
            assessmentData[index].priority = priority;
            saveData();
        }

        function updateDashboard() {
            let implemented = 0;
            let partial = 0;
            let notImplemented = 0;
            let na = 0;
            let total = 0;

            const riskCounts = {critical: 0, high: 0, medium: 0, low: 0};
            const controlCounts = {};

            Object.values(assessmentData).forEach(item => {
                if (item.status === 'implemented') {
                    implemented++;
                    total += 1;
                } else if (item.status === 'partial') {
                    partial++;
                    total += 0.5;
                } else if (item.status === 'not-implemented') {
                    notImplemented++;
                } else if (item.status === 'na') {
                    na++;
                }

                if (item.risk && item.risk !== 'na') {
                    riskCounts[item.risk]++;
                }

                const controlId = item.control.id;
                if (!controlCounts[controlId]) {
                    controlCounts[controlId] = {name: item.control.category, implemented: 0, total: 0};
                }
                
                if (item.status !== 'na') {
                    controlCounts[controlId].total++;
                    if (item.status === 'implemented') {
                        controlCounts[controlId].implemented += 1;
                    } else if (item.status === 'partial') {
                        controlCounts[controlId].implemented += 0.5;
                    }
                }
            });

            const applicable = Object.keys(assessmentData).length - na;
            const score = applicable > 0 ? (total / applicable * 100).toFixed(1) : 0;

            document.getElementById('overallScore').textContent = score + '%';
            document.getElementById('fullyImplemented').textContent = implemented;
            document.getElementById('partiallyImplemented').textContent = partial;
            document.getElementById('notImplemented').textContent = notImplemented;
            document.getElementById('progressBar').style.width = score + '%';
            document.getElementById('progressBar').textContent = score + '%';

            updateControlChart(controlCounts);
            updateRiskChart(riskCounts);
            updateTopGaps();
        }

        function updateControlChart(controlCounts) {
            const container = document.getElementById('controlChart');
            container.innerHTML = '';

            Object.entries(controlCounts).forEach(([id, data]) => {
                const percentage = data.total > 0 ? (data.implemented / data.total * 100).toFixed(1) : 0;
                const color = percentage >= 80 ? '#22c55e' : percentage >= 50 ? '#eab308' : '#dc2626';
                
                const item = document.createElement('div');
                item.className = 'bar-item';
                item.innerHTML = `
                    <div class="bar-label">Control ${id}</div>
                    <div class="bar-bg">
                        <div class="bar-fill" style="width: ${percentage}%; background: ${color};">
                            ${percentage}%
                        </div>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function updateRiskChart(riskCounts) {
            const container = document.getElementById('riskChart');
            container.innerHTML = '';

            const risks = [
                {label: 'Critical', count: riskCounts.critical, color: '#dc2626'},
                {label: 'High', count: riskCounts.high, color: '#f97316'},
                {label: 'Medium', count: riskCounts.medium, color: '#eab308'},
                {label: 'Low', count: riskCounts.low, color: '#22c55e'}
            ];

            const maxCount = Math.max(...Object.values(riskCounts), 1);

            risks.forEach(risk => {
                const percentage = (risk.count / maxCount * 100);
                const item = document.createElement('div');
                item.className = 'bar-item';
                item.innerHTML = `
                    <div class="bar-label">${risk.label}</div>
                    <div class="bar-bg">
                        <div class="bar-fill" style="width: ${percentage}%; background: ${risk.color};">
                            ${risk.count}
                        </div>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function updateTopGaps() {
            const container = document.getElementById('topGaps');
            container.innerHTML = '';

            const gaps = Object.values(assessmentData)
                .filter(item => item.status === 'not-implemented' && (item.risk === 'critical' || item.risk === 'high'))
                .sort((a, b) => {
                    const riskOrder = {critical: 0, high: 1};
                    return riskOrder[a.risk] - riskOrder[b.risk];
                })
                .slice(0, 10);

            if (gaps.length === 0) {
                container.innerHTML = '<p style="color: #22c55e; font-weight: 600;">üéâ No critical or high-risk gaps found!</p>';
                return;
            }

            gaps.forEach(gap => {
                const item = document.createElement('div');
                item.className = 'gap-item';
                item.style.borderLeftColor = gap.risk === 'critical' ? '#dc2626' : '#f97316';
                item.style.background = gap.risk === 'critical' ? '#fef2f2' : '#fff7ed';
                item.innerHTML = `
                    <h4>${gap.control.safeguard} - ${gap.control.title}</h4>
                    <p><strong>Risk:</strong> ${gap.risk === 'critical' ? 'üî¥ Critical' : 'üü† High'} | 
                    <strong>Category:</strong> ${gap.control.category}</p>
                    ${gap.notes ? `<p style="margin-top: 8px; font-style: italic;">${gap.notes}</p>` : ''}
                `;
                container.appendChild(item);
            });
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function saveData() {
            localStorage.setItem('cisAssessment', JSON.stringify(assessmentData));
        }

        function loadData() {
            const saved = localStorage.getItem('cisAssessment');
            if (saved) {
                assessmentData = JSON.parse(saved);
                
                Object.entries(assessmentData).forEach(([index, data]) => {
                    const row = document.getElementById('tableBody').rows[index];
                    if (row && data.status) {
                        row.cells[4].querySelector('select').value = data.status;
                        row.cells[5].querySelector('textarea').value = data.notes || '';
                        if (data.risk) row.cells[6].querySelector('select').value = data.risk;
                        if (data.priority) row.cells[7].querySelector('select').value = data.priority;
                    }
                });
                
                updateDashboard();
            }
        }

        function loadSampleData() {
            if (confirm('This will load sample assessment data. Continue?')) {
                const samples = [
                    {index: 0, status: 'implemented', risk: 'na', notes: 'Asset inventory maintained in ServiceNow CMDB'},
                    {index: 1, status: 'partial', risk: 'medium', notes: 'Manual process, no automated detection'},
                    {index: 13, status: 'not-implemented', risk: 'critical', priority: 'immediate', notes: 'MFA not enabled on customer portal'},
                    {index: 14, status: 'not-implemented', risk: 'critical', priority: 'immediate', notes: 'Admin accounts do not require MFA'},
                    {index: 19, status: 'partial', risk: 'high', notes: 'EDR deployed but not on all endpoints'}
                ];

                samples.forEach(sample => {
                    const row = document.getElementById('tableBody').rows[sample.index];
                    if (row) {
                        row.cells[4].querySelector('select').value = sample.status;
                        row.cells[5].querySelector('textarea').value = sample.notes;
                        if (sample.risk) row.cells[6].querySelector('select').value = sample.risk;
                        if (sample.priority) row.cells[7].querySelector('select').value = sample.priority;
                        
                        assessmentData[sample.index].status = sample.status;
                        assessmentData[sample.index].notes = sample.notes;
                        assessmentData[sample.index].risk = sample.risk || '';
                        assessmentData[sample.index].priority = sample.priority || '';
                    }
                });

                updateDashboard();
                saveData();
                alert('Sample data loaded successfully!');
            }
        }

        function clearData() {
            if (confirm('This will clear all assessment data. Are you sure?')) {
                localStorage.removeItem('cisAssessment');
                location.reload();
            }
        }

        function exportToCSV() {
            let csv = 'Control,Safeguard,Title,Category,Implementation Status,Evidence/Notes,Risk Level,Priority\n';
            
            Object.values(assessmentData).forEach(item => {
                const row = [
                    item.control.id,
                    item.control.safeguard,
                    `"${item.control.title}"`,
                    `"${item.control.category}"`,
                    item.status,
                    `"${item.notes.replace(/"/g, '""')}"`,
                    item.risk,
                    item.priority
                ].join(',');
                csv += row + '\n';
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `CIS_Assessment_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
        }

        function exportToJSON() {
            const exportData = {
                exportDate: new Date().toISOString(),
                assessment: assessmentData
            };

            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `CIS_Assessment_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
        }

        // Initialize on load
        window.onload = function() {
            initializeTable();
            loadData();
        };
    </script>
</body>
</html>
